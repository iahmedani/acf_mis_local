<!doctype html>
<html lang="en">

<head>
  <title>Screening: Children</title>
  <!--  meta tags -->
  <meta charset="utf-8">
  <!-- Bootstrap CSS -->
  <link rel="stylesheet" href="../bower_components/bootstrap/dist/css/bootstrap.min.css" crossorigin="anonymous">
  <link rel="stylesheet" href="../fa5/css/fontawesome-all.min.css">
  <link rel="stylesheet" href="../css/semantic.min.css">

</head>
<body>
    <header>
      <nav class="navbar navbar-light sticky-top flex-md-nowrap p-0" style="background-color: #e3f2fd;">
        <a class="navbar-brand col-sm-3 col-md-2 mr-0" href="#">
          <img src="../img/acf-logo.svg" style="height: 50px;" alt="">
            </a>
            <ul class="navbar-nav px-3">
            
            </ul>
          </nav>
    </header>
  <div class="container">
    <div class="equal width form">
    <form action="#" id="myFormv1" class="ui form">
      <div class="four fields">
        <div class="field">
          <label>Province:</label>
          <select id="ddProvince" class="ui dropdown">
            <option value="">Select One</option>
          </select>
        </div>
        <div class="field">
            <label for="ddDistrict">District:</label>
          <select id="ddDistrict" class="ui dropdown" >
            <option value="">Select One</option>
          </select>
        </div>
        <div class="field">
            <label for="ddTehsil" >Tehsil:</label>
          <select id="ddTehsil" class="ui dropdown" >
            <option value="">Select One</option>
          </select>
        </div>
        <div class="field">
            <label for="ddUC" >UC:</label>
          <select id="ddUC" class="ui dropdown" >
            <option value="">Select One</option>
          </select>
        </div>
      </div>
      <div class="four fields">
        <div class="field">
            <label for="ddHealthHouse" >Site Name:</label>
          <select name="ddHealthHouse" id="ddHealthHouse" class="ui dropdown" >
            <option value="">Select One</option>
          </select>
        </div>
        <div class="field">
            <label for="txtSiteType" >Site Type:</label>
          <input type="text" readonly id="txtSiteType" >
        </div>
        <div class="field">
            <label for="txtVillage" >Village:</label>
          <input type="text" name="txtVillage" >
        </div>
        <div class="field">
            <label for="txtStaffName" >Staff Name:</label>
          <input type="text" name="txtStaffName" >
        </div>
      </div>
      <div class="two fields">
        <div class="field">      
            <label for="scrChildScrType" >Screening Type</label>
        <select name="scrChildScrType" id="scrChildScrType" class="ui dropdown" >
          <option value="">Select One</option>
          <option value="1">Active</option>
          <option value="0">Passive</option>
        </select>
        </div>
        <div class="field">
            <label for="txtStaffName" >Screening Date:</label>
          <input type="date" name="txtScrChildDate"  id="txtScrChildDate" >
        </div>
      </div>
      <div class="field">
        <table class="table table-bordered table-sm table-responsive" id="tb">
          <!-- <thead> -->
          <tr>
            <td>Name</td>
            <td>F'Name</td>
            <td>Address</td>
            <td>Age <small>(Months)</small></td>
            <td>Gender</td>
            <td>MUAC</td>
            <td>Oedema</td>
            <td># of MM Sach:</td>
            <td>Deworming</td>
            <td>Status </td>
            <td>
              <a href="javascript:void(0);" style="font-size:18px;" id="addMore" title="Add More Person">
                <i class="fas fa-plus-square "></i>
              </a>
            </td>
          </tr>
          <tr>
            <td>
              <input type="text" name="txtScrChildName" >
            </td>
            <td>
              <input type="text" name="txtScrChildFather"  >
            </td>
            <td>
              <input type="text" name="txtScrChildAddr" >
            </td>
            <td>
              <input type="number" min="6" max="59" name="numScrChildAge"  >
            </td>
            <td>
                <!-- <div class="one wide field"> -->
              <select name="ddGender"  >
                <option value="">Select</option>
                <option value="1">Male</option>
                <option value="2">Female</option>
              </select>
              <!-- </div> -->
            </td>
            <td>
              <input type="number" min="0"  name="numMUAC" >
            </td>
            <td>
              <select name="ddYesNoOedema"  >
                <option value="">Select</option>
                <option value="1">Y</option>
                <option value="0">N</option>
              </select>
            </td>
            <td>
              <input type="number" min="0" name="numMMSche" class="form-control form-control-sm" >
            </td>
            <td>
              <select name="ddYesNoDeworming"  >
                <option value="">Select</option>
                <option value="1">Y</option>
                <option value="0">N</option>
              </select>
            </td>
            <td>
              <select name="ddScrChildStatus"  >
                  <option value="">Select</option>
                  <option value="1">Normal</option>
                  <option value="2">MAM</option>
                  <option value="3">SAM</option>
                </select>
            </td>
            <td>
              <a href='javascript:void(0);' class='remove'>
                <i class="fas fa-trash"></i>
              </a>
            </td>
          </tr>
        </table>
      </div>
      <div class="form-group row">
        <div class="offset-sm-10 col-sm-2">
          <button type="submit" class="btn btn-primary" id="formSub">Save</button>
        </div>
      </div>
      <div class="field">
          <div class="ui error message"></div>
      </div>
    </form>
  </div>  
  </div>
  <!-- Optional JavaScript -->
  <!-- jQuery first, then Popper.js, then Bootstrap JS -->
  <script>
    window.$ = window.jQuery = require('jquery');
    require('jquery-validation');
  </script>
    <script src="../bower_components/bootstrap/dist/js/bootstrap.bundle.js"></script>
    <script src="../js/semantic.min.js"></script>
  <script>
  //       $('.ui.form')
  // .form({
  //   fields: {
  //     ddHealthHouse: {
  //       identifier: 'ddHealthHouse',
  //       rules: [
  //         {
  //           type   : 'empty',
  //           prompt : 'Please select one Nutrition site'
  //         }
  //       ]
  //     },
  //     txtVillage: {
  //       identifier: 'txtVillage',
  //       rules: [
  //         {
  //           type   : 'empty',
  //           prompt : 'Please enter Village name'
  //         }
  //       ]
  //     },
  //     txtStaffName: {
  //       identifier: 'txtStaffName',
  //       rules: [
  //         {
  //           type   : 'empty',
  //           prompt : 'Please enter staff name'
  //         }
  //       ]
  //     },
  //     scrChildScrType: {
  //       identifier: 'scrChildScrType',
  //       rules: [
  //         {
  //           type   : 'empty',
  //           prompt : 'Please select screening type'
  //         }
  //       ]
  //     },
  //     txtScrChildDate: {
  //       identifier: 'txtScrChildDate',
  //       rules: [
  //         {
  //           type   : 'empty',
  //           prompt : 'Please enter screening date'
  //         }
  //       ]
  //     },
  //     txtScrChildName: {
  //       identifier: 'txtScrChildName',
  //       rules: [
  //         {
  //           type   : 'empty',
  //           prompt : 'Please enter child name'
  //         }
  //       ]
  //     },
  //     txtScrChildFather: {
  //       identifier: 'txtScrChildFather',
  //       rules: [
  //         {
  //           type   : 'empty',
  //           prompt : 'Please enter child\'s father name'
  //         }
  //       ]
  //     },
  //     txtScrChildAddr: {
  //       identifier: 'txtScrChildAddr',
  //       rules: [
  //         {
  //           type   : 'empty',
  //           prompt : 'Please enter address'
  //         }
  //       ]
  //     },
  //     numScrChildAge: {
  //       identifier: 'numScrChildAge',
  //       rules: [
  //         {
  //           type   : 'empty',
  //           prompt : 'Please provide childs age in months'
  //         }
  //       ]
  //     },
  //     ddGender: {
  //       identifier: 'ddGender',
  //       rules: [
  //         {
  //           type   : 'empty',
  //           prompt : 'Please select a gender'
  //         }
  //       ]
  //     },
  //     ddYesNoOedema: {
  //       identifier: 'ddYesNoOedema',
  //       rules: [
  //         {
  //           type   : 'empty',
  //           prompt : 'Please provide oedema infomrmation'
  //         }
  //       ]
  //     },
  //     ddYesNoDeworming: {
  //       identifier: 'ddYesNoDeworming',
  //       rules: [
  //         {
  //           type   : 'empty',
  //           prompt : 'Please provide deworming status'
  //         }
  //       ]
  //     },ddScrChildStatus: {
  //       identifier: 'ddScrChildStatus',
  //       rules: [
  //         {
  //           type   : 'empty',
  //           prompt : 'Please select child status'
  //         }
  //       ]
  //     }
  //   }
  // });

  
  </script>

  <script>
    (function ($) {
      $.fn.serializeFormJSON = function () {

        var o = {};
        var a = this.serializeArray();
        $.each(a, function () {
          if (o[this.name]) {
            if (!o[this.name].push) {
              o[this.name] = [o[this.name]];
            }
            o[this.name].push(this.value || '');
          } else {
            o[this.name] = this.value || '';
          }
        });
        return o;
      };
    })(jQuery);
    const ipc = require('electron').ipcRenderer;
    // $('#myForm').validate();
    // $('#myForm').on('submit', function (e) {
    //   // $(this).validate();
    //   // if ($(this).valid()) {
    //     var formData = $(this).serializeFormJSON();
    //     e.preventDefault();
    //     ipc.send('scrAddChild', formData);
    //     // formData = '';
    //     // location.reload();
    //   // }
    // })

    $(function () {
      $('select.dropdown')
  .dropdown()
;
      //Adding Row
      $('#addMore').on('click', function () {
        var data = $("#tb tr:eq(1)").clone(true).appendTo("#tb");
        data.find("input").val('');
      });
      $(document).on('click', '.remove', function () {
        var trIndex = $(this).closest("tr").index();
        if (trIndex > 1) {
          $(this).closest("tr").remove();
        } else {
          alert("Sorry!! Can't remove first row!");
        }
      });
      var datePickerId = document.getElementById('txtScrChildDate');
      datePickerId.max = new Date().toISOString().split("T")[0];
    });
    $(function(){
      ipc.send('scrCh_getProvince');
      ipc.on('province', function(evt, province){
        $('#ddProvince').children('option:not(:first)').remove();
        
        // $('#ddProvince').find('option:gt(0)').remove();
        province.province.forEach(el=>{
          $('#ddProvince').append(`<option value="${el.id}">${el.provinceName}</option>`);
        })
        })
        $('#ddProvince').on('change', function(){
          var prov = $(this).val();
          ipc.send('scrCh_getDistrict', prov )
          ipc.on('district', function(evt, district){
            $('#ddDistrict').children('option:not(:first)').remove();
            district.district.forEach(el=>{
          $('#ddDistrict').append(`<option value="${el.id}">${el.districtName}</option>`);              
            })
          })
        })
        $('#ddDistrict').on('change', function(){
          var dist = $(this).val();
          ipc.send('scrCh_getTehsil', dist )
          ipc.on('tehsil', function(evt, tehsil){
            $('#ddTehsil').children('option:not(:first)').remove();
            tehsil.tehsil.forEach(el=>{
          $('#ddTehsil').append(`<option value="${el.id}">${el.tehsilName}</option>`);              
            })
          })
        })
        $('#ddTehsil').on('change', function(){
          var tehs = $(this).val();
          ipc.send('scrCh_getUC', tehs )
          ipc.on('uc', function(evt, uc){
            $('#ddUC').children('option:not(:first)').remove();
            uc.uc.forEach(el=>{
          $('#ddUC').append(`<option value="${el.id}">${el.ucName}</option>`);              
            })
          })
        })
        var ucForHH;
        $('#ddUC').on('change', function(){
          var ucs = $(this).val();
          ucForHH = ucs
          ipc.send('scrCh_getHealthHouse', ucs )
          ipc.on('hh', function(evt, hh){
            $('#ddHealthHouse').children('option:not(:first)').remove();
            hh.hh.forEach(el=>{
          $('#ddHealthHouse').append(`<option value="${el.id}">${el.siteName}</option>`);              
            })
          })
        })
        $('#ddHealthHouse').on('change', function(){
          // var ucs = $('#ddUC').val();
          var h_id = $(this).val();
          ipc.send('scrCh_getHealthHouseType', h_id )
          ipc.on('hhType', function(evt, hh){
            // var result = hh.hh.filter(el => el.id == $(this).val());
            if(h_id === ""){
              $('#txtSiteType').val().empty();  
            } else{

              $('#txtSiteType').val(function(){
                var site = [];
                if(hh.hh[0].OTP === 1){
                  site.push('OTP')
                }
                if(hh.hh[0].SFP === 1){
                  site.push('SFP')                
                }
                if(hh.hh[0].SC === 1){
                  site.push('SC')                
                }
                return site;
              })  
            }
            
          })
        })
      })
      ipc.on('scrChAddResp', function(evt, result){
        if(result.msg){
          $('body').append(`<div class="alert alert-success alert-dismissible fade show" role="alert">${result.msg}</div>`)  
    $('.alert').alert()
    $(".alert").fadeTo(3000, 1000).slideUp(500, function(){
    $(".alert").alert('close');
    $().alert('dispose')
      location.reload();
      // error = '';
    })
        } else {
          $('body').append(`<div class="alert alert-warning alert-dismissible fade show" role="alert">${result.err}</div>`)  
    $('.alert').alert()
    $(".alert").fadeTo(3000, 1000).slideUp(500, function(){
    $(".alert").alert('close');
    $().alert('dispose')
      location.reload();
      // error = '';
    })
        }


});
  </script>

</body>

</html>